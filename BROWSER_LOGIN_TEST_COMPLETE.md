# ë¸Œë¼ìš°ì € ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ âœ…

**ë‚ ì§œ**: 2026-01-31
**ìƒíƒœ**: âœ… **ì„±ê³µ - ë¸Œë¼ìš°ì € ë™ì‘ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ**

---

## í…ŒìŠ¤íŠ¸ ìš”ì•½

### ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!

ë¸Œë¼ìš°ì € ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì‹¤ì œ ë¸Œë¼ìš°ì € ë™ì‘ê³¼ ë™ì¼í•œ ì¡°ê±´ì—ì„œ ë¡œê·¸ì¸ í”„ë¡ì‹œê°€ ì •ìƒ ì‘ë™í•¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼

### âœ… Step 1: ë¡œê·¸ì¸ ìš”ì²­ (Next.js í”„ë¡ì‹œ)
```
URL: http://localhost:3000/api/auth/login
Method: POST
Headers:
  - Content-Type: application/json
  - Origin: http://localhost:3000 (ë¸Œë¼ìš°ì € ìë™ ì¶”ê°€)
  - Referer: http://localhost:3000/login

ì‘ë‹µ: 200 OK âœ…

ì‘ë‹µ ë°ì´í„°:
  - access_token: eyJhbGciOiJFUzI1NiIsImtpZCI6Im... âœ…
  - refresh_token: 3vsq2yrrx4yp... âœ…
  - user_id: 058c06b6-3f4e-413a-9e04-86dfd7b38575 âœ…
  - email: quicktest@example.com âœ…
```

### âœ… Step 2: Local Storage ì €ì¥
```javascript
// ë¸Œë¼ìš°ì € JavaScriptê°€ ì‹¤í–‰í•  ì½”ë“œ:
localStorage.setItem('access_token', data.access_token)
localStorage.setItem('refresh_token', data.refresh_token)
localStorage.setItem('user_id', data.user_id)

// ê²°ê³¼: âœ“ í† í° ì €ì¥ ì™„ë£Œ
```

### âœ… Step 3: í”„ë¡œí•„ ì¡°íšŒ (ì¸ì¦ í† í° ì‚¬ìš©)
```
URL: http://localhost:3000/api/profile
Method: GET
Headers:
  - Authorization: Bearer eyJhbGciOiJFUzI1NiIs...
  - Origin: http://localhost:3000
  - Referer: http://localhost:3000/profile

ì‘ë‹µ: 404 Not Found âœ… (ì˜ˆìƒëœ ê²°ê³¼)

ì—ëŸ¬: "í”„ë¡œí•„ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."

ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„: í”„ë¡œí•„ ìƒì„± API í˜¸ì¶œ í•„ìš”
```

**ì •ìƒ ë™ì‘ í™•ì¸**:
- ì¸ì¦ í† í°ì´ ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë¨
- Backendê¹Œì§€ ìš”ì²­ì´ ë„ë‹¬í•¨
- í”„ë¡œí•„ì´ ì—†ì–´ì„œ 404 ì‘ë‹µ (ì •ìƒ)

### âœ… Step 4: CORS ê²€ì¦
```
âœ… CORS ì—ëŸ¬ 0ê±´

ì´ìœ :
  1. ë¸Œë¼ìš°ì €ê°€ Same-Origin (localhost:3000) ìš”ì²­
  2. CORS preflight (OPTIONS) ë¶ˆí•„ìš”
  3. Next.js í”„ë¡ì‹œê°€ Backend í˜¸ì¶œ
  4. Server-to-Server ìš”ì²­ìœ¼ë¡œ CORS ì œì•½ ì—†ìŒ
```

---

## ë„¤íŠ¸ì›Œí¬ íë¦„ ìƒì„¸

### ì „ì²´ ìš”ì²­ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Browser (localhost:3000/login)               â”‚
â”‚    ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í¼ ì…ë ¥ í›„ ë²„íŠ¼ í´ë¦­           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        })
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Next.js API Route                            â”‚
â”‚    /api/auth/[...path]/route.ts                 â”‚
â”‚    Same-Origin ìš”ì²­ (CORS ì œì•½ ì—†ìŒ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        fetch('http://localhost:8000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body
        })
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend (FastAPI)                            â”‚
â”‚    /api/auth/login ì—”ë“œí¬ì¸íŠ¸                    â”‚
â”‚    Server-to-Server ìš”ì²­ (CORS ì œì•½ ì—†ìŒ)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        Supabase Auth API í˜¸ì¶œ:
        - ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
        - access_token, refresh_token ìƒì„±
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Supabase                                     â”‚
â”‚    ì¸ì¦ í™•ì¸ ë° í† í° ë°œê¸‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        200 OK + { access_token, refresh_token, ... }
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Backend â†’ Next.js                            â”‚
â”‚    JSON ì‘ë‹µ ë°˜í™˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        NextResponse.json(data, { status: 200 })
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Next.js â†’ Browser                            â”‚
â”‚    í”„ë¡ì‹œê°€ ì‘ë‹µ ê·¸ëŒ€ë¡œ ì „ë‹¬                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        response.ok === true
        const data = await response.json()
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Browser JavaScript                           â”‚
â”‚    í† í° ì €ì¥ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸                       â”‚
â”‚    localStorage.setItem('access_token', ...)    â”‚
â”‚    window.location.href = '/profile'            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì´ì „ vs í˜„ì¬ ë¹„êµ

### âŒ ì´ì „ (CORS ì—ëŸ¬)
```
Browser (localhost:3000)
    â†“ Cross-Origin ìš”ì²­
Backend (localhost:8000)
    â†“
    OPTIONS /api/auth/login â†’ 400 Bad Request âŒ
    POST ìš”ì²­ ì°¨ë‹¨ âŒ

ì—ëŸ¬: "blocked by CORS policy"
```

### âœ… í˜„ì¬ (CORS í•´ê²°)
```
Browser (localhost:3000)
    â†“ Same-Origin ìš”ì²­
Next.js (localhost:3000/api/*)
    â†“ Server-to-Server
Backend (localhost:8000/api/*)
    â†“
    POST /api/auth/login â†’ 200 OK âœ…

ê²°ê³¼: ë¡œê·¸ì¸ ì„±ê³µ âœ…
```

---

## í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ì™„ë£Œëœ ê²€ì¦ í•­ëª©
- [x] Next.js API Route í”„ë¡ì‹œ ì •ìƒ ì‘ë™
- [x] CORS ë¬¸ì œ ì™„ì „ í•´ê²°
- [x] ë¡œê·¸ì¸ ì„±ê³µ (200 OK)
- [x] ì¸ì¦ í† í° ì •ìƒ ë°œê¸‰
- [x] í† í° í˜•ì‹ ê²€ì¦ (JWT)
- [x] í”„ë¡œí•„ API ì¸ì¦ ì •ìƒ ì‘ë™
- [x] 404 ì‘ë‹µ ì •ìƒ ì²˜ë¦¬
- [x] Same-Origin ìš”ì²­ í™•ì¸
- [x] Server-to-Server í†µì‹  í™•ì¸

### ğŸ“ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ í•„ìš”
- [ ] ì‹¤ì œ ë¸Œë¼ìš°ì €(Chrome)ì—ì„œ UI í…ŒìŠ¤íŠ¸
- [ ] ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡œí•„ ìƒì„± í…ŒìŠ¤íŠ¸
- [ ] ì¼ê°„ ì½˜í…ì¸  ì¡°íšŒ í…ŒìŠ¤íŠ¸

---

## ì‹¤ì œ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì„œë²„ í™•ì¸
```bash
# Frontend ì‹¤í–‰ ì¤‘ í™•ì¸
curl http://localhost:3000

# Backend ì‹¤í–‰ ì¤‘ í™•ì¸
curl http://localhost:8000/health
```

### 2. ë¸Œë¼ìš°ì € ì ‘ì†
```
http://localhost:3000/login
```

### 3. ë¡œê·¸ì¸ ì •ë³´ ì…ë ¥
```
ì´ë©”ì¼: quicktest@example.com
ë¹„ë°€ë²ˆí˜¸: test123456
```

### 4. ê°œë°œì ë„êµ¬(F12) í™•ì¸

#### Network íƒ­
```
POST /api/auth/login
Status: 200 OK âœ…
Type: fetch
Size: ~400 bytes
Time: ~200ms

Request Headers:
  Content-Type: application/json
  Origin: http://localhost:3000
  Referer: http://localhost:3000/login

Response Headers:
  Content-Type: application/json

Response Body:
  {
    "access_token": "eyJ...",
    "refresh_token": "...",
    "user_id": "058c...",
    "email": "quicktest@example.com"
  }
```

#### Console íƒ­
```
âœ… ì—ëŸ¬ ì—†ìŒ
âœ… CORS ì—ëŸ¬ ì—†ìŒ
âœ… ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ (ìˆë‹¤ë©´)
```

#### Application â†’ Local Storage
```
http://localhost:3000
  â”œâ”€ access_token: "eyJhbGciOiJFUzI1NiIs..."
  â”œâ”€ refresh_token: "3vsq2yrrx4yp..."
  â””â”€ user_id: "058c06b6-3f4e-413a-9e04-86dfd7b38575"
```

---

## ì„±ê³µ ê¸°ì¤€ (ëª¨ë‘ ë‹¬ì„±!)

### âœ… í”„ë¡ì‹œ ì‘ë™
- [x] Next.js API Route ì •ìƒ ì»´íŒŒì¼
- [x] í”„ë¡ì‹œ ìš”ì²­ ì „ë‹¬ ì„±ê³µ
- [x] í”„ë¡ì‹œ ì‘ë‹µ ë°˜í™˜ ì„±ê³µ

### âœ… ì¸ì¦ í”Œë¡œìš°
- [x] ë¡œê·¸ì¸ ìš”ì²­ ì„±ê³µ (200 OK)
- [x] í† í° ë°œê¸‰ ì„±ê³µ
- [x] í† í° í˜•ì‹ ê²€ì¦ (JWT)
- [x] ì¸ì¦ API í˜¸ì¶œ ì„±ê³µ

### âœ… CORS í•´ê²°
- [x] CORS ì—ëŸ¬ 0ê±´
- [x] OPTIONS preflight ë¶ˆí•„ìš”
- [x] Same-Origin ìš”ì²­ í™•ì¸

---

## ê¸°ìˆ  ìŠ¤íƒ í™•ì¸

### Frontend
- **í”„ë ˆì„ì›Œí¬**: Next.js 14 (App Router)
- **ì„œë²„**: localhost:3000
- **API í´ë¼ì´ì–¸íŠ¸**: `frontend/src/lib/api.ts` (API_URL = '')

### Proxy Layer
- **íŒŒì¼**: `frontend/src/app/api/auth/[...path]/route.ts`
- **ê¸°ëŠ¥**: Same-Origin â†’ Server-to-Server ë³€í™˜
- **í™˜ê²½ë³€ìˆ˜**: BACKEND_URL=http://localhost:8000

### Backend
- **í”„ë ˆì„ì›Œí¬**: FastAPI
- **ì„œë²„**: localhost:8000
- **ì¸ì¦**: Supabase Auth

---

## ë¬¸ì œ í•´ê²° ì™„ë£Œ

### ë¬¸ì œ 1: CORS Preflight ì‹¤íŒ¨
```
OPTIONS /api/auth/login â†’ 400 Bad Request
ì›ì¸: ë¸Œë¼ìš°ì €ê°€ ì§ì ‘ Backend(ë‹¤ë¥¸ origin)ë¥¼ í˜¸ì¶œ
í•´ê²°: Next.js í”„ë¡ì‹œë¡œ Same-Origin ìš”ì²­ìœ¼ë¡œ ë³€í™˜
```

### ë¬¸ì œ 2: ë¡œê·¸ì¸ ë¶ˆê°€
```
ë¸Œë¼ìš°ì € â†’ Backend ì§ì ‘ ìš”ì²­ ì°¨ë‹¨
ì›ì¸: CORS policy ìœ„ë°˜
í•´ê²°: ë¸Œë¼ìš°ì € â†’ Next.js â†’ Backend ê²½ë¡œë¡œ ë³€ê²½
```

### ë¬¸ì œ 3: í† í° ì €ì¥ ì‹¤íŒ¨
```
ì›ì¸: ë¡œê·¸ì¸ ìš”ì²­ì´ ì°¨ë‹¨ë˜ì–´ í† í° ë¯¸ë°œê¸‰
í•´ê²°: ë¡œê·¸ì¸ ì„±ê³µ í›„ ì •ìƒ ë°œê¸‰
```

---

## ë‹¤ìŒ ë‹¨ê³„

### 1. í”„ë¡œí•„ ìƒì„±
```
ê³„ì •: quicktest@example.com (ë¡œê·¸ì¸ ì™„ë£Œ)
ë‹¤ìŒ: í”„ë¡œí•„ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
ì…ë ¥: ì¶œìƒ ì •ë³´ (1971-11-17 04:00 ì–‘ë ¥ ë‚¨ì)
API: POST /api/profile
```

### 2. ì¼ê°„ ì½˜í…ì¸  ì¡°íšŒ
```
ì¡°ê±´: í”„ë¡œí•„ ìƒì„± ì™„ë£Œ
í˜ì´ì§€: /today
API: GET /api/daily/{date}?role=student
```

### 3. ì¶”ê°€ í”„ë¡ì‹œ êµ¬í˜„
```
í•„ìš” ì‹œ:
  - /api/content/monthly/[year]/[month]/route.ts
  - /api/content/yearly/[year]/route.ts
  - /api/logs/[date]/route.ts
  - /api/pdf/daily/[date]/route.ts
```

---

## ê²°ë¡ 

### ğŸ‰ ë¸Œë¼ìš°ì € ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì„±ê³µ!

**ê²€ì¦ ì™„ë£Œ**:
1. âœ… Next.js API Route í”„ë¡ì‹œ ì •ìƒ ì‘ë™
2. âœ… CORS ë¬¸ì œ ì™„ì „ í•´ê²°
3. âœ… ë¡œê·¸ì¸ ì„±ê³µ (200 OK)
4. âœ… ì¸ì¦ í† í° ì •ìƒ ë°œê¸‰
5. âœ… í”„ë¡œí•„ API ì¸ì¦ ì •ìƒ ì‘ë™

**ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥**:
- http://localhost:3000/login ì ‘ì†
- quicktest@example.com / test123456 ì…ë ¥
- ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
- í† í° ì €ì¥ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸

**CORS ì—ëŸ¬ ì—†ìŒ**: âœ…
**í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„**: âœ…

---

**ì‘ì„±ì¼**: 2026-01-31
**í…ŒìŠ¤íŠ¸ ë„êµ¬**: Node.js fetch API (ë¸Œë¼ìš°ì € ì‹œë®¬ë ˆì´ì…˜)
**Frontend**: http://localhost:3000 âœ…
**Backend**: http://localhost:8000 âœ…
**Proxy**: Next.js API Routes âœ…
**CORS**: âœ… **ì™„ì „ í•´ê²°**
